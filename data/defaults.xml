<?xml version="1.0" ?>
<container xmlns="http://symfony-project.org/2.0/container">
    <parameters>
        <parameter key="general.version">0.5.1</parameter>
        <parameter key="general.timezone">Europe/Paris</parameter>

        <parameter key="logging.classes.formatter">Plop_Formatter</parameter>
        <parameter key="logging.classes.handler">Plop_Handler_Stream</parameter>
        <parameter key="logging.classes.logger">Plop_Logger</parameter>

        <parameter key="i18n.default_getter" type="collection">
            <parameter>Locale</parameter>
            <parameter>getDefault</parameter>
        </parameter>

        <parameter key="core.classes.core">\Erebot\Core</parameter>
        <parameter key="core.classes.connection">\Erebot\IrcConnection</parameter>
        <parameter key="core.classes.connection_factory">\Erebot\ConnectionFactory</parameter>
        <parameter key="core.classes.i18n">\Erebot\I18N\I18N</parameter>
        <parameter key="core.classes.identity">\Erebot\Identity</parameter>
        <parameter key="core.classes.timer">\Erebot\Timer\Timer</parameter>
        <parameter key="core.classes.eventhandler">\Erebot\EventHandler</parameter>
        <parameter key="core.classes.numerichandle">\Erebot\NumericHandler</parameter>
    </parameters>

    <services>
        <service id="logging.formatter.detailed" class="%logging.classes.formatter%">
            <argument>%%(asctime)s - %%(levelname)s - %%(message)s</argument>
            <argument>r</argument>
        </service>

        <service id="logging.formatter.input" class="%logging.classes.formatter%">
            <argument>%%(asctime)s - &#8592; %(message)s</argument>
            <argument>r</argument>
        </service>

        <service id="logging.formatter.output" class="%logging.classes.formatter%">
            <argument>%%(asctime)s - &#8594; %%(message)s</argument>
            <argument>r</argument>
        </service>

        <service id="logging.handler.input" class="%logging.classes.handler%">
            <argument type="const">STDERR</argument>
            <call method="setFormatter">
                <argument type="service" id="logging.formatter.input"/>
            </call>
        </service>

        <service id="logging.handler.output" class="%logging.classes.handler%">
            <argument type="const">STDERR</argument>
            <call method="setFormatter">
                <argument type="service" id="logging.formatter.output"/>
            </call>
        </service>

        <service id="logging.handler.detailed" class="%logging.classes.handler%">
            <argument type="const">STDERR</argument>
            <call method="setFormatter">
                <argument type="service" id="logging.formatter.detailed"/>
            </call>
        </service>

        <service id="logging.logger.input" class="%logging.classes.logger%">
            <argument type="const">NULL</argument>
            <argument>\Erebot\LineIO</argument>
            <argument>_getLine</argument>
            <argument type="service">
                <service class="Plop_HandlersCollection">
                    <call method="offsetSet">
                        <argument type="const">NULL</argument>
                        <argument type="service" id="logging.handler.input"/>
                    </call>
                </service>
            </argument>
        </service>

        <service id="logging.logger.output" class="%logging.classes.logger%">
            <argument type="const">NULL</argument>
            <argument>\Erebot\LineIO</argument>
            <argument>write</argument>
            <argument type="service">
                <service class="Plop_HandlersCollection">
                    <call method="offsetSet">
                        <argument type="const">NULL</argument>
                        <argument type="service" id="logging.handler.output"/>
                    </call>
                </service>
            </argument>
        </service>

        <service id="logging.logger.root" class="%logging.classes.logger%">
            <argument type="const">NULL</argument>
            <argument type="const">NULL</argument>
            <argument type="const">NULL</argument>
            <argument type="service">
                <service class="Plop_HandlersCollection">
                    <call method="offsetSet">
                        <argument type="const">NULL</argument>
                        <argument type="service" id="logging.handler.detailed"/>
                    </call>
                </service>
            </argument>
        </service>

        <service id="logging" class="Plop" constructor="getInstance" shared="true">
            <call method="addLogger">
                <argument type="service" id="logging.logger.root"/>
                <argument type="service" id="logging.logger.input"/>
                <argument type="service" id="logging.logger.output"/>
            </call>
            <call method="setPrefixes">
                <argument type="service">
                    <service class="Plop_PrefixesCollection">
                        <call method="offsetSet">
                            <argument type="const">NULL</argument>
                            <argument>%Erebot.src_dir%</argument>
                        </call>
                    </service>
                </argument>
            </call>
        </service>

        <service id="factory.connection" class="%core.classes.connection_factory%">
            <argument>%core.classes.connection%</argument>
            <argument type="collection">
                <argument key="\Erebot\Interface\Event\Ban">\Erebot\Event\Ban</argument>
                <argument key="\Erebot\Interface\Event\ChanAction">\Erebot\Event\ChanAction</argument>
                <argument key="\Erebot\Interface\Event\ChanAction">\Erebot\Event\ChanAction</argument>
                <argument key="\Erebot\Interface\Event\ChanCtcp">\Erebot\Event\ChanCtcp</argument>
                <argument key="\Erebot\Interface\Event\ChanCtcpReply">\Erebot\Event\ChanCtcpReply</argument>
                <argument key="\Erebot\Interface\Event\ChanNotice">\Erebot\Event\ChanNotice</argument>
                <argument key="\Erebot\Interface\Event\ChanText">\Erebot\Event\ChanText</argument>
                <argument key="\Erebot\Interface\Event\Connect">\Erebot\Event\Connect</argument>
                <argument key="\Erebot\Interface\Event\DeHalfop">\Erebot\Event\DeHalfop</argument>
                <argument key="\Erebot\Interface\Event\DeOp">\Erebot\Event\DeOp</argument>
                <argument key="\Erebot\Interface\Event\DeOwner">\Erebot\Event\DeOwner</argument>
                <argument key="\Erebot\Interface\Event\DeProtect">\Erebot\Event\DeProtect</argument>
                <argument key="\Erebot\Interface\Event\DeVoice">\Erebot\Event\DeVoice</argument>
                <argument key="\Erebot\Interface\Event\Disconnect">\Erebot\Event\Disconnect</argument>
                <argument key="\Erebot\Interface\Event\Error">\Erebot\Event\Error</argument>
                <argument key="\Erebot\Interface\Event\Except">\Erebot\Event\Except</argument>
                <argument key="\Erebot\Interface\Event\Exit">\Erebot\Event\Exit</argument>
                <argument key="\Erebot\Interface\Event\Halfop">\Erebot\Event\Halfop</argument>
                <argument key="\Erebot\Interface\Event\Invite">\Erebot\Event\Invite</argument>
                <argument key="\Erebot\Interface\Event\Join">\Erebot\Event\Join</argument>
                <argument key="\Erebot\Interface\Event\Kick">\Erebot\Event\Kick</argument>
                <argument key="\Erebot\Interface\Event\Logon">\Erebot\Event\Logon</argument>
                <argument key="\Erebot\Interface\Event\Nick">\Erebot\Event\Nick</argument>
                <argument key="\Erebot\Interface\Event\Notify">\Erebot\Event\Notify</argument>
                <argument key="\Erebot\Interface\Event\Op">\Erebot\Event\Op</argument>
                <argument key="\Erebot\Interface\Event\Owner">\Erebot\Event\Owner</argument>
                <argument key="\Erebot\Interface\Event\Part">\Erebot\Event\Part</argument>
                <argument key="\Erebot\Interface\Event\Ping">\Erebot\Event\Ping</argument>
                <argument key="\Erebot\Interface\Event\Pong">\Erebot\Event\Pong</argument>
                <argument key="\Erebot\Interface\Event\PrivateAction">\Erebot\Event\PrivateAction</argument>
                <argument key="\Erebot\Interface\Event\PrivateCtcp">\Erebot\Event\PrivateCtcp</argument>
                <argument key="\Erebot\Interface\Event\PrivateCtcpReply">\Erebot\Event\PrivateCtcpReply</argument>
                <argument key="\Erebot\Interface\Event\PrivateNotice">\Erebot\Event\PrivateNotice</argument>
                <argument key="\Erebot\Interface\Event\PrivateText">\Erebot\Event\PrivateText</argument>
                <argument key="\Erebot\Interface\Event\Protect">\Erebot\Event\Protect</argument>
                <argument key="\Erebot\Interface\Event\Quit">\Erebot\Event\Quit</argument>
                <argument key="\Erebot\Interface\Event\Numeric">\Erebot\Event\Numeric</argument>
                <argument key="\Erebot\Interface\Event\RawMode">\Erebot\Event\RawMode</argument>
                <argument key="\Erebot\Interface\Event\Topic">\Erebot\Event\Topic</argument>
                <argument key="\Erebot\Interface\Event\UnBan">\Erebot\Event\UnBan</argument>
                <argument key="\Erebot\Interface\Event\UnExcept">\Erebot\Event\UnExcept</argument>
                <argument key="\Erebot\Interface\Event\UnNotify">\Erebot\Event\UnNotify</argument>
                <argument key="\Erebot\Interface\Event\UserMode">\Erebot\Event\UserMode</argument>
                <argument key="\Erebot\Interface\Event\Voice">\Erebot\Event\Voice</argument>
            </argument>
        </service>

<!--        <service id="identd" class="Erebot_Identd_Server">-->
<!--            <argument type="service" id="bot"/>-->
<!--            <argument>0.0.0.0:113</argument>-->
<!--            <argument>Erebot_Identd_Worker</argument>-->
<!--        </service>-->
    </services>
</container>
